<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Biology Dictionary (Bangla)</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {margin: 0; font-family: Arial, sans-serif; background: #000; color: #fff; min-height: 100vh; overflow-x: hidden;}
    .title-bar {background: #005f73; color: white; text-align: left; padding: 12px; font-size: 20px; font-weight: bold; display: flex; align-items: center; gap: 10px; position: relative; z-index: 10;}
    .title-bar .icon-home-label {display: flex; align-items: center; gap: 5px; margin-right: 18px;}
    .header {display: flex; align-items: center; background: #111; gap: 8px; padding: 0 12px 0 8px; min-height: 58px; position: relative; z-index: 9;}
    .menu-btn {font-size: 28px; color: #fff; cursor: pointer; background: none; border: none; margin-right: 6px; margin-left: 3px;}
    .search-bar {flex: 1; padding: 10px 12px; background: #222; border: none; color: white; border-radius: 6px; font-size: 18px; margin-right: 6px; margin-left: 6px; outline: none; letter-spacing: 0.5px;}
    .icon-btn {background: none; border: none; color: #e0e0e0; font-size: 26px; cursor: pointer; border-radius: 50%; padding: 5px; margin-right: 3px; margin-left: 3px; transition: color 0.2s, background 0.2s;}
    .icon-btn:hover {color: #4fc3f7; background: #222;}
    .sidebar {position: fixed; top: 0; left: -260px; width: 260px; height: 100%; background: #101c28; padding-top: 62px; transition: left 0.3s cubic-bezier(.4,0,.2,1); z-index: 1000; box-shadow: 2px 0 8px rgba(0,0,0,0.2); overflow-y: auto;}
    .sidebar.active {left: 0;}
    .sidebar a {padding: 15px 28px; text-decoration: none; display: flex; align-items: center; color: #fff; border-bottom: 1px solid #1c2635; font-size: 18px; gap: 13px; transition: background 0.2s, color 0.2s; cursor: pointer;}
    .sidebar a:hover, .sidebar a.active {background: #222; color: #4fc3f7;}
    .sidebar-icon {font-size: 23px;}
    .overlay, .history-overlay, .contact-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.4);
      display: none;
      z-index: 999;
    }
    .overlay.active, .history-overlay.active, .contact-overlay.active {display: block;}
    .main {padding: 18px 6px 50px 6px; margin-top: 5px; max-width: 650px; margin-left: auto; margin-right: auto;}
    .definition {background: #222; padding: 15px; border-radius: 8px; margin-top: 20px;}
    .definition h2 {margin-top: 0; color: #4fc3f7;}
    .definition .breakdown {margin: 8px 0; color: #ffd166;}
    .definition .meaning {margin: 6px 0; color: #fff;}
    .definition .example {color: #aaa; font-style: italic; margin-top: 10px;}
    .not-found {color: red; margin-top: 22px; font-size: 18px;}
    .suggestions {margin-top: 10px; background: #1a1a1a; border-radius: 5px; padding: 10px;}
    .suggestion-item {padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #333; font-size: 17px; color: #fff;}
    .suggestion-item:hover {background: #333; color: #4fc3f7;}
    #quizPanel {background: #1a1a1a; padding: 18px; border-radius: 10px; margin-top: 18px; position: relative;}
    #quizPanel h2 {color: #4fc3f7;}
    #nextQuizBtn {margin-top: 16px; background: #005f73; color: #fff; border: none; padding: 9px 16px; border-radius: 7px; cursor: pointer; font-size: 16px;}
    .quiz-opt-btn {margin: 7px 0; padding: 7px 11px; border-radius: 5px; background: #222; color: #fff; border: 1px solid #444; cursor: pointer; font-size: 16px; width: 100%; text-align: left; transition: background 0.2s, color 0.2s;}
    .quiz-opt-btn:hover:enabled {background: #333; color: #4fc3f7;}
    .close-btn {position: absolute; top: 10px; right: 16px; background: #333; color: #fff; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 20px;}
    .close-btn:hover {background: #c62828;}
    /* History Panel Popup */
    #historyPanelPopup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      color: #fff;
      border-radius: 13px;
      box-shadow: 0 8px 40px #0006;
      width: 95vw;
      max-width: 480px;
      max-height: 80vh;
      z-index: 1500;
      padding: 0;
      display: none;
      flex-direction: column;
      overflow: hidden;
    }
    #historyPanelPopup.active {display: flex;}
    #historyPanelHeader {
      padding: 14px 18px 10px 24px;
      background: #005f73;
      font-size: 21px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    #historyPanelBody {
      flex: 1;
      padding: 10px 19px 16px 19px;
      overflow-y: auto;
      background: #222;
    }
    .history-word {
      padding: 7px 0;
      cursor: pointer;
      border-bottom: 1px solid #333;
      font-size: 17px;
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .history-word:hover {color: #4fc3f7;}
    .history-options {
      margin: 8px 0 10px 0;
      display: flex;
      gap: 6px;
      font-size: 14px;
      align-items: center;
    }
    .history-options label {cursor: pointer;}
    .popup-close-btn {
      background: #333;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      cursor: pointer;
      font-size: 20px;
      margin-left: 7px;
    }
    .popup-close-btn:hover {background: #c62828;}
    /* Quiz Mode Popup */
    #quizModePopup {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      color: #fff;
      border-radius: 13px;
      box-shadow: 0 8px 40px #0006;
      width: 95vw;
      max-width: 350px;
      z-index: 2000;
      padding: 0;
      display: none;
      flex-direction: column;
      overflow: hidden;
    }
    #quizModePopup.active {display: flex;}
    #quizModePopupHeader {
      padding: 14px 18px 10px 24px;
      background: #005f73;
      font-size: 19px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    #quizModePopupBody {
      flex: 1;
      padding: 18px 19px 18px 19px;
      background: #222;
      display: flex;
      flex-direction: column;
      gap: 17px;
      align-items: center;
    }
    .quiz-mode-radio label {font-size:16px; margin-left:6px; cursor:pointer;}
    .quiz-mode-radio {margin-bottom:7px;}
    #quizModePopupBtn {
      background: #005f73;
      color: #fff;
      border: none;
      padding: 8px 22px;
      border-radius: 7px;
      cursor: pointer;
      font-size: 17px;
    }
    #quizModePopupBtn:hover {background:#207490;}
    /* Contact Popup */
    #contactPopup {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      color: #fff;
      border-radius: 13px;
      box-shadow: 0 8px 40px #0006;
      width: 95vw;
      max-width: 340px;
      z-index: 2100;
      padding: 0;
      display: none;
      flex-direction: column;
      overflow: hidden;
    }
    #contactPopup.active {display: flex;}
    #contactPopupHeader {
      padding: 14px 18px 10px 24px;
      background: #005f73;
      font-size: 19px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    #contactPopupBody {
      flex: 1;
      padding: 18px 19px 18px 19px;
      background: #222;
      display: flex;
      flex-direction: column;
      gap: 14px;
      align-items: flex-start;
      font-size: 16px;
    }
    .contact-item b {color:#4fc3f7;}
    @media (max-width:600px) {
      .main, .definition {padding: 7px;}
      .sidebar {width: 96vw; padding-top: 55px;}
      .title-bar {font-size: 19px;}
      #historyPanelPopup, #quizModePopup, #contactPopup {max-width: 98vw;}
    }
  </style>
</head>
<body>
  <div class="title-bar">
    <span class="icon-home-label">
      <span class="material-icons" style="font-size:28px;">home</span>
      <span>Home</span>
    </span>
    <span class="icon">üî¨</span>
    <span>Biology Dictionary (Bangla)</span>
  </div>
  <div class="header">
    <button class="menu-btn material-icons" id="menuBtn" type="button">menu</button>
    <span class="lang-toggle">E&gt;B</span>
    <input type="text" id="searchInput" class="search-bar" placeholder="'EN'/'BN' text here." onkeyup="showSuggestions()">
    <button class="icon-btn material-icons" onclick="searchWord()">search</button>
    <button class="icon-btn material-icons" id="quizIconBtn" title="Quiz">quiz</button>
    <button class="icon-btn material-icons" onclick="showHistoryPopup()" title="History">history</button>
  </div>
  <div class="sidebar" id="sidebar">
    <a href="#" onclick="showMain(); return false;" id="sideHome"><span class="sidebar-icon material-icons">home</span>Home</a>
    <a href="#" onclick="showBookmarks(); return false;" id="sideBookmark"><span class="sidebar-icon material-icons">bookmark</span>Bookmark</a>
    <a href="#" onclick="showHistoryPopup(); return false;" id="sideHistory"><span class="sidebar-icon material-icons">history</span>History</a>
    <a href="#" onclick="showQuizModePopup(); return false;" id="sideQuiz"><span class="sidebar-icon material-icons">quiz</span>Quiz</a>
    <a href="#" onclick="showAddWordForm(); return false;"><span class="sidebar-icon material-icons">add_circle</span>Add or Edit Words</a>
    <a href="#" onclick="showContactPopup(); return false;" id="sideContact"><span class="sidebar-icon material-icons">contact_mail</span>Contact</a>
    <a href="#"><span class="sidebar-icon material-icons">settings</span>Settings</a>
    <a href="#"><span class="sidebar-icon material-icons">palette</span>App Themes</a>
    <a href="#"><span class="sidebar-icon material-icons">backup</span>Backup in the File System</a>
    <a href="#"><span class="sidebar-icon material-icons">cloud_upload</span>Backup in Google Drive</a>
    <a href="#"><span class="sidebar-icon material-icons">restore</span>Restore from the File System</a>
    <a href="#"><span class="sidebar-icon material-icons">cloud_download</span>Restore from Google Drive</a>
    <a href="#"><span class="sidebar-icon material-icons">email</span>Email me your comments</a>
    <a href="#"><span class="sidebar-icon material-icons">copyright</span>Copyright</a>
    <a href="#"><span class="sidebar-icon material-icons">warning</span>Disclaimer</a>
    <a href="#"><span class="sidebar-icon material-icons">person</span>About</a>
  </div>
  <div class="overlay" id="overlay"></div>
  <!-- ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶™‡¶™‡¶Ü‡¶™‡ßá‡¶∞ overlay -->
  <div class="history-overlay" id="historyOverlay"></div>
  <!-- Contact Popup Overlay -->
  <div class="contact-overlay" id="contactOverlay"></div>
  <!-- ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ Popup -->
  <div id="historyPanelPopup">
    <div id="historyPanelHeader">
      ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø
      <button class="popup-close-btn" id="closeHistoryPopupBtn" title="Close">&times;</button>
    </div>
    <div class="history-options">
      <label><input type="radio" name="quizMode" value="history" checked> ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßÅ‡¶á‡¶ú</label>
      <label><input type="radio" name="quizMode" value="random"> ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßÅ‡¶á‡¶ú</label>
      <button class="icon-btn material-icons" id="startHistoryQuizBtn" title="‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®" style="font-size:20px;vertical-align:middle;">play_arrow</button>
    </div>
    <div id="historyPanelBody"></div>
  </div>
  <!-- Quiz Mode Choose Popup -->
  <div id="quizModePopup">
    <div id="quizModePopupHeader">
      ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
      <button class="popup-close-btn" id="closeQuizModePopupBtn" title="Close">&times;</button>
    </div>
    <div id="quizModePopupBody">
      <div class="quiz-mode-radio">
        <input type="radio" id="quizAnyWord" name="quizModeChoose" value="random" checked>
        <label for="quizAnyWord">‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßÅ‡¶á‡¶ú</label>
      </div>
      <div class="quiz-mode-radio">
        <input type="radio" id="quizHistoryWord" name="quizModeChoose" value="history">
        <label for="quizHistoryWord">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßÅ‡¶á‡¶ú</label>
      </div>
      <button id="quizModePopupBtn">Quiz ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
  </div>
  <!-- Contact Popup -->
  <div id="contactPopup">
    <div id="contactPopupHeader">
      ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
      <button class="popup-close-btn" id="closeContactPopupBtn" title="Close">&times;</button>
    </div>
    <div id="contactPopupBody">
      <div class="contact-item"><b>Email:</b> alimulazad2@gmail.com</div>
      <div class="contact-item"><b>Telegram:</b> <a href="https://t.me/Alimulazad" style="color:#4fc3f7;" target="_blank">t.me/Alimulazad</a></div>
      <div class="contact-item"><b>WhatsApp:</b> <a href="https://wa.me/8801863198499" style="color:#4fc3f7;" target="_blank">+8801863198499</a></div>
    </div>
  </div>
  <div class="main" id="mainContent">
    <div id="suggestionBox" class="suggestions"></div>
    <div id="resultArea"></div>
    <div id="quizPanel" style="display:none;">
      <button class="close-btn" id="closeQuizBtn" title="Close">&times;</button>
      <h2>Quiz Panel</h2>
      <div id="quizQuestion"></div>
      <div id="quizOptions"></div>
      <div id="quizFeedback" style="margin-top:10px; font-size:17px;"></div>
      <button id="nextQuizBtn" style="display:none;">Next</button>
    </div>
  </div>
  <script>
    // --- Example Bangla dictionary data structure ---
    <script src="./dictionary.js"></script>
  <script>
    // --- sidebar and overlay logic ---
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const menuBtn = document.getElementById('menuBtn');
    menuBtn.onclick = function() {
      sidebar.classList.add('active');
      overlay.classList.add('active');
    };
    overlay.onclick = function() {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
    };
    document.querySelectorAll('#sidebar a').forEach(function(a){
      a.addEventListener('click', function(){
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
      });
    });

    // --- Dictionary logic ---
    let localWords = JSON.parse(localStorage.getItem('localWords') || "[]");
    let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || "[]");
    let history = JSON.parse(localStorage.getItem('history') || "[]");
    let serverWords = [];

    function getCombinedDictionary() {
      return [...dictionary, ...localWords, ...serverWords];
    }

    function setSidebarActive(id) {
      ["sideHome", "sideBookmark", "sideHistory", "sideQuiz"].forEach(i => {
        let el = document.getElementById(i);
        if (el) el.classList.remove("active");
      });
      if (id) {
        let el = document.getElementById(id);
        if (el) el.classList.add("active");
      }
    }

    function closeAllPanels() {
      document.getElementById("resultArea").style.display = "none";
      document.getElementById("suggestionBox").style.display = "none";
      document.getElementById("quizPanel").style.display = "none";
    }

    function showMain() {
      setSidebarActive("sideHome");
      closeAllPanels();
      document.getElementById("resultArea").style.display = "block";
      document.getElementById("suggestionBox").style.display = "block";
    }

    function showBookmarks() {
      setSidebarActive("sideBookmark");
      closeAllPanels();
      document.getElementById("resultArea").style.display = "block";
      document.getElementById("resultArea").innerHTML = "<b>Bookmarks:</b><br>" + (bookmarks.length ? bookmarks.map(w => `<div>${w.word}</div>`).join("") : "No bookmarks yet.");
    }

    function showAddWordForm() {
      alert("Add/Edit word panel not implemented in this demo.");
    }

    // --- search + suggestion ---
    function searchWord() {
      closeAllPanels();
      setSidebarActive("sideHome");
      document.getElementById("resultArea").style.display = "block";
      document.getElementById("suggestionBox").style.display = "block";
      const input = document.getElementById("searchInput").value.trim().toLowerCase();
      document.getElementById("resultArea").innerHTML = "";
      document.getElementById("suggestionBox").innerHTML = "";
      let allDict = getCombinedDictionary();
      let result = allDict.find(entry => entry.word.toLowerCase() === input);
      if (result) {
        displayResult(result);
        addToHistory(result);
      } else {
        document.getElementById("resultArea").innerHTML = `<p class="not-found">‚ùå Sorry, word not found.</p>`;
      }
    }
    function showSuggestions() {
      const input = document.getElementById("searchInput").value.trim().toLowerCase();
      document.getElementById("suggestionBox").innerHTML = "";
      if (input.length === 0) return;
      let allDict = getCombinedDictionary();
      const matches = allDict.filter(entry => entry.word.toLowerCase().startsWith(input)).slice(0, 5);
      matches.forEach(entry => {
        const item = document.createElement("div");
        item.className = "suggestion-item";
        item.textContent = entry.word;
        item.onclick = () => {
          document.getElementById("searchInput").value = entry.word;
          document.getElementById("suggestionBox").innerHTML = "";
          searchWord();
        };
        document.getElementById("suggestionBox").appendChild(item);
      });
    }

    // --- Result function for Bangla structure ---
    function displayResult(result) {
      document.getElementById("resultArea").innerHTML = `
        <div class="definition">
          <h2>${result.word}</h2>
          <div class="breakdown"><b>‡¶ó‡¶†‡¶®:</b> ${result.breakdown ? result.breakdown : "‚Äî"}</div>
          <div class="meaning"><b>‡¶Ö‡¶∞‡ßç‡¶•:</b> ${result.meaning ? result.meaning : "‚Äî"}</div>
          <div class="example"><b>‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£:</b> ${result.example ? result.example : "‚Äî"}</div>
        </div>
      `;
    }

    function capitalize(word) {
      return word.charAt(0).toUpperCase() + word.slice(1);
    }
    function addToHistory(wordObj) {
      if (!history.find(item => item.word === wordObj.word)) {
        history.unshift({ word: wordObj.word, time: new Date().toLocaleString() });
        if (history.length > 50) history.pop();
        localStorage.setItem('history', JSON.stringify(history));
      }
    }
    window.onload = showMain;

    // ---- QUIZ PANEL ----
    let quizWords = [];
    let quizIndex = 0;
    let quizAnswer = "";
    let quizMode = "random"; // "history" or "random"
    function startQuizFromMode(mode) {
      closeQuizModePopup();
      showQuizPanel(mode);
    }
    function showQuizPanel(wordsSource) {
      closeAllPanels();
      setSidebarActive("sideQuiz");
      document.getElementById("quizPanel").style.display = "block";
      quizMode = wordsSource || "random";
      if (quizMode === "history" && history.length) {
        quizWords = history.map(h => getCombinedDictionary().find(w => w.word === h.word)).filter(Boolean).sort(() => Math.random() - 0.5);
        if (quizWords.length === 0) quizWords = getCombinedDictionary().sort(() => Math.random() - 0.5).slice(0, 5);
      } else {
        quizWords = getCombinedDictionary().sort(() => Math.random() - 0.5).slice(0, 5);
      }
      quizIndex = 0;
      showQuizQuestion();
    }
    function showQuizQuestion() {
      if (quizIndex >= quizWords.length) {
        document.getElementById("quizQuestion").innerHTML = "Quiz Finished! üéâ";
        document.getElementById("quizOptions").innerHTML = "";
        document.getElementById("nextQuizBtn").style.display = "none";
        document.getElementById("quizFeedback").textContent = "";
        return;
      }
      let current = quizWords[quizIndex];
      document.getElementById("quizQuestion").innerHTML = `<b>"${current.word}" ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶• ‡¶ï‡ßÄ?</b>`;
      let all = getCombinedDictionary().filter(w => w.word !== current.word);
      let wrongs = all.sort(() => Math.random() - 0.5).slice(0, 3).map(w => w.meaning);
      let options = [current.meaning, ...wrongs].sort(() => Math.random() - 0.5);
      quizAnswer = current.meaning;
      let html = "";
      options.forEach((opt, i) => {
        html += `<button class="quiz-opt-btn" onclick="checkQuizAnswer(this, '${opt.replace(/'/g,"\\'")}')">${opt}</button>`;
      });
      document.getElementById("quizOptions").innerHTML = html;
      document.getElementById("quizFeedback").textContent = "";
      document.getElementById("nextQuizBtn").style.display = "none";
    }
    window.checkQuizAnswer = function(btn, selected) {
      if (selected === quizAnswer) {
        btn.style.background = "#005f73";
        btn.style.color = "#fff";
        document.getElementById("quizFeedback").textContent = "‚úÖ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞!";
      } else {
        btn.style.background = "#c62828";
        btn.style.color = "#fff";
        document.getElementById("quizFeedback").textContent = "‚ùå ‡¶≠‡ßÅ‡¶≤! ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞: " + quizAnswer;
      }
      document.querySelectorAll(".quiz-opt-btn").forEach(b => b.disabled = true);
      document.getElementById("nextQuizBtn").style.display = "inline-block";
    }
    document.getElementById("nextQuizBtn").onclick = function() {
      quizIndex++;
      showQuizQuestion();
    };
    // ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ï‡ßç‡¶≤‡ßã‡¶ú
    document.getElementById("closeQuizBtn").onclick = function() {
      document.getElementById("quizPanel").style.display = "none";
      showMain();
    };

    // ---- QUIZ MODE POPUP ----
    const quizModePopup = document.getElementById("quizModePopup");
    const quizModePopupBtn = document.getElementById("quizModePopupBtn");
    const closeQuizModePopupBtn = document.getElementById("closeQuizModePopupBtn");
    function showQuizModePopup() {
      setSidebarActive("sideQuiz");
      quizModePopup.classList.add("active");
      document.body.style.overflow = "hidden";
    }
    function closeQuizModePopup() {
      quizModePopup.classList.remove("active");
      document.body.style.overflow = "";
    }
    closeQuizModePopupBtn.onclick = closeQuizModePopup;
    quizModePopupBtn.onclick = function() {
      let mode = document.querySelector('input[name="quizModeChoose"]:checked').value;
      startQuizFromMode(mode);
    };
    // Header ‡¶Ü‡¶á‡¶ï‡¶®‡ßá‡¶∞ ‡¶ï‡ßÅ‡¶á‡¶ú‡ßá‡¶ì ‡¶è‡¶á ‡¶™‡¶™‡¶Ü‡¶™
    document.getElementById("quizIconBtn").onclick = showQuizModePopup;

    // ---- HISTORY POPUP ----
    const historyPanelPopup = document.getElementById("historyPanelPopup");
    const historyOverlay = document.getElementById("historyOverlay");
    function showHistoryPopup() {
      setSidebarActive("sideHistory");
      renderHistoryPanel();
      historyPanelPopup.classList.add("active");
      historyOverlay.classList.add("active");
      document.body.style.overflow = "hidden";
    }
    function closeHistoryPopup() {
      historyPanelPopup.classList.remove("active");
      historyOverlay.classList.remove("active");
      document.body.style.overflow = "";
    }
    document.getElementById("closeHistoryPopupBtn").onclick = closeHistoryPopup;
    historyOverlay.onclick = closeHistoryPopup;
    // ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞
    function renderHistoryPanel() {
      const body = document.getElementById("historyPanelBody");
      if (!history.length) {
        body.innerHTML = "<i>‡¶ï‡ßã‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶®‡ßá‡¶á</i>";
        return;
      }
      body.innerHTML = history.map(h =>
        `<div class="history-word" onclick="showHistoryWordDetail('${h.word}')">
          <span>${h.word}</span>
          <span style="font-size:12px; color:#aaa;">${h.time ? h.time : ""}</span>
        </div>`
      ).join("");
    }
    // ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
    window.showHistoryWordDetail = function(word) {
      const found = getCombinedDictionary().find(w => w.word === word);
      if (found) {
        const body = document.getElementById("historyPanelBody");
        body.innerHTML = `
          <button class="popup-close-btn" onclick="renderHistoryPanel()" style="float:right; margin-top:5px; margin-bottom:7px;">&#8592;</button>
          <div class="definition">
            <h2>${found.word}</h2>
            <div class="breakdown"><b>‡¶ó‡¶†‡¶®:</b> ${found.breakdown ? found.breakdown : "‚Äî"}</div>
            <div class="meaning"><b>‡¶Ö‡¶∞‡ßç‡¶•:</b> ${found.meaning ? found.meaning : "‚Äî"}</div>
            <div class="example"><b>‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£:</b> ${found.example ? found.example : "‚Äî"}</div>
          </div>
        `;
      }
    }
    // ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ
    document.getElementById("startHistoryQuizBtn").onclick = function() {
      closeHistoryPopup();
      let mode = document.querySelector('input[name="quizMode"]:checked').value;
      showQuizPanel(mode);
    };
    document.querySelectorAll('input[name="quizMode"]').forEach(function(radio){
      radio.onchange = function() {
        quizMode = this.value;
      };
    });

    // ---- CONTACT POPUP ----
    const contactPopup = document.getElementById("contactPopup");
    const contactOverlay = document.getElementById("contactOverlay");
    function showContactPopup() {
      contactPopup.classList.add("active");
      contactOverlay.classList.add("active");
      document.body.style.overflow = "hidden";
    }
    function closeContactPopup() {
      contactPopup.classList.remove("active");
      contactOverlay.classList.remove("active");
      document.body.style.overflow = "";
    }
    document.getElementById("closeContactPopupBtn").onclick = closeContactPopup;
    contactOverlay.onclick = closeContactPopup;
  </script>
</body>
  </html>
